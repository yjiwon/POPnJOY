<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.popcorn.mapper.ShopMapper">

	<select id="goodsList" resultType="org.popcorn.domain.GoodsVO">
		select
		gdsId, gdsName, gdsCat, gdsPrice, gdsStock, gdsDes, gdsImage, gdsDate
		from goods
		where gdsCat = #{gdsCat,jdbcType=VARCHAR}
	</select>

	<select id="goodsView" resultType="org.popcorn.domain.GoodsVO">
		select
		gdsId, gdsName, gdsCat, gdsPrice, gdsStock, gdsDes, gdsImage, gdsDate
		from goods
		where gdsId = #{gdsId}
	</select>

	<!-- 카테고리 -->
	<sql id="cat">
		<if test="gdsCat != null" >
			<if test="gdsCat == popcorn">
				and catCode = popcorn
			</if>
			<if test="gdsCat == drink">
				and catCode = drink
			</if>
			<if test="gdsCat == hotdog">
				and catCode = hotdog
			</if>
			<if test="gdsCat == Snack">
				and catCode = Snack
			</if>

		</if>

	</sql>

	<!-- 카트 담기 -->
	<insert id="addCart">
		insert into cart (cartNum, gdsId, cartStock)
		values (cart_seq.nextval, #{gdsId}, #{cartStock})
	</insert>

	<!-- 카트 리스트 -->
	<select id="cartList" resultType="org.popcorn.domain.CartListVO">
		select
		row_number() over(order by c.cartNum desc) as num,
		c.cartNum, c.gdsId, c.cartStock, name
		g.gdsName, g.gdsPrice,
		from cart c
		inner join goods g
		on c.gdsId = g.gdsId
		where c.name = #{name}
	</select>

	<!-- 카트 삭제 -->
	<delete id="deleteCart">
		delete cart
		where cartNum = #{cartNum}
	</delete>

	<!-- 주문 정보 -->
	<insert id="orderInfo">
		insert into tbl_order(orderId, orderPhone, amount)
		values(#{orderId}, #{orderPhone}, #{amount})
	</insert>

	<!-- 주문 상세 정보 -->
	<insert id="orderInfo_Details">
		insert into tbl_order_details(orderDetailsNum, orderId, gdsId, cartStock)
		select order_details_seq.nextval, #{orderId}, gdsId, cartStock
		from cart
	</insert>

	<!-- 카트 비우기 -->
	<delete id="cartAllDelete">
		delete cart
		where cartNum = #{orderId}
	</delete>

	<!-- 특정 유저의 주문 목록 -->
	<select id="orderList" resultType="org.popcorn.domain.OrderVO">
		select
		orderId,
		orderPhone, amount, orderDate
		from  tbl_order
		where name = #{orderId}
	</select>


</mapper>