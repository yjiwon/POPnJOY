<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.popcorn.mappers.ShopMapper">

	<select id="list" resultType="org.popcorn.domain.GoodsVO">
		select
		gdsId, gdsName, gdsCat, gdsPrice, gdsStock, gdsDes, gdsImage, gdsDate
		from goods
		where gdsCat = #{gdsCat,jdbcType=VARCHAR}
	</select>

	<select id="goodsView" resultType="org.popcorn.domain.GoodsVO">
		select
		gdsId, gdsName, gdsCat, gdsPrice, gdsStock, gdsDes, gdsImage, gdsDate
		from goods
		where gdsId = #{gdsId}
	</select>

	<!-- 카테고리 -->
	<sql id="cat">
		<if test="gdsCat != null" >
			<if test="gdsCat == popcorn">
				and catCode = popcorn
			</if>
			<if test="gdsCat == drink">
				and catCode = drink
			</if>
			<if test="gdsCat == hotdog">
				and catCode = hotdog
			</if>
			<if test="gdsCat == Snack">
				and catCode = Snack
			</if>

		</if>

	</sql>

	<!-- 카트 담기 -->
	<insert id="addCart">
		insert into tbl_cart (cartNum, name, gdsNum, cartStock)
		values (tbl_cart_seq.nextval, #{name}, #{gdsNum}, #{cartStock})
	</insert>

	<!-- 카트 리스트 -->
	<select id="cartList" resultType="com.popcorn.domain.CartListVO">
		select
		row_number() over(order by c.cartNum desc) as num,
		c.cartNum, c.gdsNum, c.cartStock, name
		g.gdsName, g.gdsPrice,
		from cart c
		inner join goods g
		on c.gdsId = g.gdsId
		where c.name = #{name}
	</select>

	<!-- 카트 삭제 -->
	<delete id="deleteCart">
		delete cart
		where cartNum = #{cartNum}
		and name = #{name}
	</delete>

	<!-- 주문 정보 -->
	<insert id="orderInfo">
		insert into order(orderId, name, orderRec, orderPhone, amount)
		values(#{orderId}, #{userId}, #{orderRec}, #{orderPhone}, #{amount})
	</insert>

	<!-- 주문 상세 정보 -->
	<insert id="orderInfo_Details">
		insert into order_details(orderDetailsNum, orderId, gdsNum, cartStock)
		select order_details_seq.nextval, #{orderId}, gdsNum, cartStock
		from cart
	</insert>

	<!-- 카트 비우기 -->
	<delete id="cartAllDelete">
		delete cart
		where name = #{name}
	</delete>

	<!-- 특정 유저의 주문 목록 -->
	<select id="orderList" resultType="com.popcorn.domain.OrderVO">
		select
		orderId, userId, orderRec,
		orderPhone, amount, orderDate, delivery
		from order
		where name = #{name}
	</select>


</mapper>